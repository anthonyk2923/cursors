import{t as K,b as B,n as F}from"../chunks/CQ37X0C3.js";import{i as ae}from"../chunks/CZhIHbkO.js";import{y as ne,r as L,h as te,L as r,a2 as oe,z as ie,A as Y,c as z,s as O,d as $,e as le,B as Q,o as Z,C as fe,a3 as H,l as j,t as J,a4 as ce,a5 as de,a6 as W,a7 as ve,a8 as ue,k as pe,a9 as _e,Y as he,aa as ye,ab as ge,a as me,W as xe,ac as we,ad as ke,ae as Ee,p as Ae,af as b,ag as I,ah as be,u as Ne,$ as C,a1 as q,a0 as D,_ as P}from"../chunks/DE0S399y.js";import{e as Te}from"../chunks/5xY_qTeW.js";import{i as Ie,b as Le}from"../chunks/Co3oE8KU.js";function X(n,e){return e}function Me(n,e,s,i){for(var l=[],v=e.length,u=0;u<v;u++)ue(e[u].e,l,!0);var g=v>0&&l.length===0&&s!==null;if(g){var p=s.parentNode;pe(p),p.append(s),i.clear(),N(n,e[0].prev,e[v-1].next)}_e(l,()=>{for(var m=0;m<v;m++){var t=e[m];g||(i.delete(t.k),N(n,t.prev,t.next)),he(t.e,!g)}})}function U(n,e,s,i,l,v=null){var u=n,g={items:new Map,first:null};L&&te();var p=null,m=!1,t=oe(()=>{var h=s();return xe(h)?h:h==null?[]:j(h)});ne(()=>{var h=r(t),f=h.length;if(m&&f===0)return;m=f===0;let y=!1;if(L){var _=u.data===ie;_!==(f===0)&&(u=Y(),z(u),O(!1),y=!0)}if(L){for(var E=null,w,c=0;c<f;c++){if($.nodeType===8&&$.data===le){u=$,y=!0,O(!1);break}var k=h[c],T=i(k,c);w=ee($,g,E,null,k,T,c,l,e,s),g.items.set(T,w),E=w}f>0&&z(Y())}L||Se(h,g,u,l,e,i,s),v!==null&&(f===0?p?Q(p):p=Z(()=>v(u)):p!==null&&fe(p,()=>{p=null})),y&&O(!0),r(t)}),L&&(u=$)}function Se(n,e,s,i,l,v,u){var g=n.length,p=e.items,m=e.first,t=m,h,f=null,y=[],_=[],E,w,c,k;for(k=0;k<g;k+=1){if(E=n[k],w=v(E,k),c=p.get(w),c===void 0){var T=t?t.e.nodes_start:s;f=ee(T,e,f,f===null?e.first:f.next,E,w,k,i,l,u),p.set(w,f),y=[],_=[],t=f.next;continue}if($e(c,E,k),c.e.f&H&&Q(c.e),c!==t){if(h!==void 0&&h.has(c)){if(y.length<_.length){var M=_[0],o;f=M.prev;var a=y[0],d=y[y.length-1];for(o=0;o<y.length;o+=1)V(y[o],M,s);for(o=0;o<_.length;o+=1)h.delete(_[o]);N(e,a.prev,d.next),N(e,f,a),N(e,d,M),t=M,f=d,k-=1,y=[],_=[]}else h.delete(c),V(c,t,s),N(e,c.prev,c.next),N(e,c,f===null?e.first:f.next),N(e,f,c),f=c;continue}for(y=[],_=[];t!==null&&t.k!==w;)t.e.f&H||(h??(h=new Set)).add(t),_.push(t),t=t.next;if(t===null)continue;c=t}y.push(c),f=c,t=c.next}if(t!==null||h!==void 0){for(var x=h===void 0?[]:j(h);t!==null;)t.e.f&H||x.push(t),t=t.next;var S=x.length;if(S>0){var R=null;Me(e,x,R,p)}}J.first=e.first&&e.first.e,J.last=f&&f.e}function $e(n,e,s,i){ce(n.v,e),n.i=s}function ee(n,e,s,i,l,v,u,g,p,m){var t=(p&ye)!==0,h=(p&ge)===0,f=t?h?de(l):W(l):l,y=p&ve?W(u):u,_={i:y,v:f,k:v,a:null,e:null,prev:s,next:i};try{return _.e=Z(()=>g(n,f,y,m),L),_.e.prev=s&&s.e,_.e.next=i&&i.e,s===null?e.first=_:(s.next=_,s.e.next=_.e),i!==null&&(i.prev=_,i.e.prev=_.e),_}finally{}}function V(n,e,s){for(var i=n.next?n.next.e.nodes_start:s,l=e?e.e.nodes_start:s,v=n.e.nodes_start;v!==i;){var u=me(v);l.before(v),v=u}}function N(n,e,s){e===null?n.first=s:(e.next=s,e.e.next=s&&s.e),s!==null&&(s.prev=e,s.e.prev=e&&e.e)}function A(n,e,s,i){var l=n.__attributes??(n.__attributes={});L&&(l[e]=n.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&n.nodeName==="LINK")||l[e]!==(l[e]=s)&&(e==="style"&&"__styles"in n&&(n.__styles={}),e==="loading"&&(n[we]=s),s==null?n.removeAttribute(e):typeof s!="string"&&Ce(n).includes(e)?n[e]=s:n.setAttribute(e,s))}var G=new Map;function Ce(n){var e=G.get(n.nodeName);if(e)return e;G.set(n.nodeName,e=[]);for(var s,i=n,l=Element.prototype;l!==i;){s=Ee(i);for(var v in s)s[v].set&&e.push(v);i=ke(i)}return e}var De=F('<svg class="absolute inset-0 w-full h-full pointer-events-none select-none"><line stroke="white" stroke-width="2" stroke-dasharray="8,5" stroke-opacity="0.5"></line></svg>'),Re=F('<svg class="absolute inset-0 w-full h-full pointer-events-none select-none"><line stroke-width="2" stroke-linecap="square" stroke-dasharray="2,20" stroke-opacity="0.5"></line></svg>'),Be=K('<div class="absolute pointer-events-none select-none"><svg class="w-4 h-4 pointer-events-none select-none" fill="none" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2C8.134 2 5 5.134 5 9c0 5 7 13 7 13s7-8 7-13c0-3.866-3.134-7-7-7z"></path><circle cx="12" cy="9" r="2.5"></circle></svg></div>'),Oe=K('<div class="h-screen w-screen cursor-none select-none"><div class="bg-stone-950 relative w-full h-full pointer-events-none"><!> <!> <!></div></div>');function We(n,e){Ae(e,!1);const s=new WebSocket("wss://cursorsserver.onrender.com/ws");let i=I([]),l=I([]),v=I(0),u=I(0),g=I(),p=I(!1),m=I({x:0,y:0}),t;s.addEventListener("open",()=>console.log("WS connected")),s.addEventListener("error",console.error),s.addEventListener("close",()=>console.log("WS closed")),s.addEventListener("message",o=>{try{const a=JSON.parse(o.data);if(typeof a=="object"&&a.type&&a.payload)switch(a.type){case"p":Array.isArray(a.payload)&&b(i,a.payload);break;case"b":h(a.payload);break;case"i":t||(t=JSON.parse(o.data).payload.id,console.log("Assigned socket ID:",t));break;default:console.warn("Unknown message type:",a.type)}}catch{console.log("Raw event data:",o.data)}});function h(o){b(l,[...r(l),o]),console.log("Before timeout:",r(l)),setTimeout(()=>{b(l,r(l).filter(a=>a!==o)),console.log("After timeout:",r(l))},500)}const f=o=>{if(!r(g))return;const a=r(g).getBoundingClientRect();if(b(v,o.clientX-a.left),b(u,o.clientY-a.top),o.buttons===1){b(p,!0);for(let d=0;d<r(i).length;d++)r(i)[d].user_id==t&&b(m,{x:r(i)[d].x,y:r(i)[d].y})}else r(p)&&_(r(v),r(u),r(m)),b(p,!1),b(m,{}),r(v)>=0&&r(v)<=a.width&&r(u)>=0&&r(u)<=a.height&&y()},y=()=>{s.send(JSON.stringify({type:"p",payload:{x:r(v),y:r(u)}}))},_=(o,a,d)=>{const x=o-d.x,S=a-d.y,R=Math.sqrt(x*x+S*S),se=x/R,re=S/R;s.send(JSON.stringify({type:"b",payload:{dx:se,dy:re}}))};ae();var E=Oe();Te("mousemove",be.body,f);var w=C(E),c=C(w);{var k=o=>{var a=De(),d=C(a);D(a),P(()=>{A(d,"x1",r(m).x),A(d,"y1",r(m).y),A(d,"x2",r(v)),A(d,"y2",r(u))}),B(o,a)};Ie(c,o=>{r(p)&&o(k)})}var T=q(c,2);U(T,1,()=>r(l),X,(o,a)=>{var d=Re(),x=C(d);D(d),P(()=>{A(x,"x1",r(a).fromPoint.x),A(x,"y1",r(a).fromPoint.y),A(x,"x2",r(a).isHit.x),A(x,"y2",r(a).isHit.y),A(x,"stroke",`rgb(${r(a).fromPoint.color.r}, ${r(a).fromPoint.color.g}, ${r(a).fromPoint.color.b}`)}),B(o,d)});var M=q(T,2);U(M,1,()=>r(i),X,(o,a)=>{var d=Be(),x=C(d);D(d),P(()=>{A(d,"style",`left: ${r(a).x??""}px; top: ${r(a).y??""}px;`),A(x,"stroke",`rgb(${r(a).color.r}, ${r(a).color.g}, ${r(a).color.b}`)}),B(o,d)}),D(w),Le(w,o=>b(g,o),()=>r(g)),D(E),B(n,E),Ne()}export{We as component};
